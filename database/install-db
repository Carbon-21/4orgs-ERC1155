#!/bin/bash

source ../api-2.0/.env

#install mysql
sudo apt install default-mysql-server

#set systemd
sudo systemctl disable mysql
sudo systemctl start mysql

#create carbon user with low password policy and all permissions
sudo mysql --execute "SET GLOBAL validate_password.policy=LOW" -p
sudo mysql --execute "CREATE USER carbon@localhost IDENTIFIED BY $MYSQL_PASSWORD" -p
sudo mysql --execute "GRANT ALL ON *.* TO carbon@localhost WITH GRANT OPTION" -p
sudo mysql --execute "CREATE USER carbon@$HOST IDENTIFIED BY $MYSQL_PASSWORD" -p
sudo mysql --execute "GRANT ALL ON *.* TO carbon@$HOST WITH GRANT OPTION" -p


#create carbon db
mysql -u carbon -p --execute "source carbon.sql" -p
